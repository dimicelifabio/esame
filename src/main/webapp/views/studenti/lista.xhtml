<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/index.xhtml">
    
    <ui:define name="content">
        <h:form id="studenteForm">
            <p:panel header="Lista Studenti">
                <p:dataTable id="studenteTable" value="#{studenteController.studenti}" var="studente">
                    <!-- Colonne della tabella -->
                    <p:column headerText="ID">
                        <h:outputText value="#{studente.id}" />
                    </p:column>
                    <p:column headerText="Nome">
                        <h:outputText value="#{studente.nome}" />
                    </p:column>
                    <p:column headerText="Cognome">
                        <h:outputText value="#{studente.cognome}" />
                    </p:column>
                    <p:column headerText="Matricola">
                        <h:outputText value="#{studente.matricola}" />
                    </p:column>
                    <p:column headerText="Azioni">
                        <p:commandButton icon="pi pi-pencil" update=":dialogStudenteModifica" 
                                         oncomplete="PF('dlgStudenteModifica').show()" 
                                         action="#{studenteController.selezionaStudentePerModifica(studente)}" />
                        <p:commandButton icon="pi pi-trash" update="@form :growl"
                                         action="#{studenteController.eliminaStudente(studente.id)}">
                            <p:confirm header="Conferma" message="Sei sicuro di voler eliminare questo studente?" icon="pi pi-exclamation-triangle" />
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
                
                <p:commandButton value="Nuovo Studente" update=":dialogNuovoStudente" 
                                 oncomplete="PF('dlgNuovoStudente').show()" />
            </p:panel>
        </h:form>
        
        <!-- Dialog per nuovo studente -->
        <p:dialog id="dialogNuovoStudente" widgetVar="dlgNuovoStudente" header="Nuovo Studente" modal="true">
            <h:form id="nuovoStudenteForm">
                <!-- Form per nuovo studente -->
                <p:panelGrid columns="2">
                    <p:outputLabel for="nome" value="Nome:" />
                    <p:inputText id="nome" value="#{studenteController.nuovoStudente.nome}" required="true" />
                    
                    <p:outputLabel for="cognome" value="Cognome:" />
                    <p:inputText id="cognome" value="#{studenteController.nuovoStudente.cognome}" required="true" />
                    
                    <p:outputLabel for="matricola" value="Matricola:" />
                    <p:inputText id="matricola" value="#{studenteController.nuovoStudente.matricola}" required="true" />
                </p:panelGrid>
                
                <p:commandButton value="Salva" action="#{studenteController.salvaStudente()}" 
                                 update="@form :studenteForm:studenteTable :growl" 
                                 oncomplete="if(!args.validationFailed) PF('dlgNuovoStudente').hide()" />
                <p:commandButton value="Annulla" onclick="PF('dlgNuovoStudente').hide()" immediate="true" />
            </h:form>
        </p:dialog>
        
        <!-- Dialog per modifica studente -->
        <p:dialog id="dialogStudenteModifica" widgetVar="dlgStudenteModifica" header="Modifica Studente" modal="true">
            <h:form id="studenteFormModifica">
                <!-- Form per modifica studente -->
                <p:panelGrid columns="2">
                    <p:outputLabel for="nomeModifica" value="Nome:" />
                    <p:inputText id="nomeModifica" value="#{studenteController.studenteSelezionato.nome}" required="true" />
                    
                    <p:outputLabel for="cognomeModifica" value="Cognome:" />
                    <p:inputText id="cognomeModifica" value="#{studenteController.studenteSelezionato.cognome}" required="true" />
                    
                    <p:outputLabel for="matricolaModifica" value="Matricola:" />
                    <p:inputText id="matricolaModifica" value="#{studenteController.studenteSelezionato.matricola}" required="true" />
                </p:panelGrid>
                
                <p:commandButton value="Salva Modifiche" action="#{studenteController.aggiornaStudente()}" 
                                 process="@form" update="@form :studenteForm:studenteTable :growl" 
                                 oncomplete="if(!args.validationFailed) PF('dlgStudenteModifica').hide()" />
                <p:commandButton value="Annulla" onclick="PF('dlgStudenteModifica').hide()" immediate="true" />
            </h:form>
        </p:dialog>
        
        <p:confirmDialog global="true">
            <p:commandButton value="SÃ¬" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times" />
        </p:confirmDialog>
    </ui:define>
</ui:composition>